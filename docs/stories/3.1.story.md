---
epic: 3
story-id: 1
title: "Display Staged Transactions for Review"
status: "Draft"
---

### 1. Story

As a user, after a job is processed, I want to be taken to a review screen where I can see all the extracted transactions in a table, so I can begin the review process.

### 2. Acceptance Criteria

1.  A new page is accessible at the route `/jobs/{jobId}`.
2.  When the page loads, it calls a new backend endpoint to fetch all staged transactions associated with the given `jobId`.
3.  A new backend endpoint `GET /api/v1/import-jobs/{jobId}/transactions` is created.
4.  The backend endpoint retrieves and returns the list of `StagedTransaction` records from the database.
5.  The frontend displays the fetched transactions in a data table (e.g., MUI Data Grid).
6.  The table includes columns for at least: Date, Description, and Amount.
7.  If the job is still processing or fails to load, an appropriate status message (e.g., loading indicator or error message) is displayed.

### 3. Dev Notes

#### Previous Story Insights
*   This page is the destination after an upload is initiated (Story 2.3). It consumes the data produced by the background job (Story 2.4).

#### Data Models
*   **`StagedTransaction`**: The frontend will fetch and display a list of these records.
    *   `[Source: architecture.md#4.3 Model: StagedTransaction]`

#### API Specifications
*   **`GET /api/v1/import-jobs/{jobId}/transactions`**: This new endpoint is the core of the story. It must be implemented on the backend.
    *   It should be secured to ensure a user can only fetch transactions for a job they own.
    *   `[Source: architecture.md#5.1 REST API Specification (OpenAPI)]`

#### Component Specifications
*   **Data Grid**: The primary component for this page. It should be configured to display the transaction data.
    *   MUI Data Grid is the recommended component.
    *   Initial implementation should be read-only. Editing will be added in the next story.
    *   `[Source: front-end-spec.md#5.1 Core Components]`

#### File Locations
*   **Frontend Page**: `apps/web/src/app/jobs/[jobId]/page.tsx` (using Next.js dynamic routing).
*   **Frontend Component**: `apps/web/src/components/review/TransactionTable.tsx`.
*   **Backend API Endpoint**: The `apps/api/routers/import_jobs.py` file will be updated to include the new endpoint.

#### Testing Requirements
*   **Backend (Pytest)**:
    *   Write unit tests for the `GET .../transactions` endpoint.
    *   Test that it correctly returns transactions for a valid job ID and user.
    *   Test that it returns a 404 or 403 for an invalid job ID or unauthorized user.
*   **Frontend (Jest/RTL)**:
    *   Test the `TransactionTable.tsx` component.
    *   Mock the API call and test the display of data, as well as the loading and error states.

### 4. Tasks / Subtasks

1.  **Backend: Create API Endpoint (AC: 3, 4)**
    *   [ ] In `apps/api/routers/import_jobs.py`, add the `GET /{jobId}/transactions` endpoint.
    *   [ ] Implement the logic to query the `staged_transactions` table based on the `jobId` path parameter, ensuring the job belongs to the authenticated user.
    *   [ ] Return the list of found transactions.
2.  **Frontend: Create Dynamic Page (AC: 1)**
    *   [ ] Create the dynamic route page at `apps/web/src/app/jobs/[jobId]/page.tsx`.
3.  **Frontend: Create Transaction Table Component (AC: 5, 6, 7)**
    *   [ ] Create the `TransactionTable.tsx` component.
    *   [ ] Use a data fetching library (like `swr` or `react-query`) to call the new backend endpoint using the `jobId` from the URL.
    *   [ ] Implement loading and error states.
    *   [ ] Use MUI Data Grid to render the transactions. Define columns for `transaction_date`, `description`, and `amount`.
4.  **Frontend: Assemble Page (AC: 2)**
    *   [ ] Import and render the `TransactionTable` component on the `[jobId]` page.
5.  **Write Tests**
    *   [ ] Implement backend unit tests for the new endpoint.
    *   [ ] Implement frontend unit tests for the new component and page.

### 5. QA Results
*   *Pending*
