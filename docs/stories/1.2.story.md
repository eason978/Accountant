---
epic: 1
story-id: 2
title: "User Login"
status: "Draft"
---

### 1. Story

As a registered user, I want to be able to log in to my account, so that I can use the import functionality.

### 2. Acceptance Criteria

1.  A user can navigate to a login page or use a login form.
2.  The login form requires the user's registered email and password.
3.  Upon successful login with Supabase Auth, the user is redirected to the main dashboard.
4.  If login fails (e.g., incorrect password), a clear error message is displayed to the user.
5.  The application should handle session management, keeping the user logged in across browser sessions until they explicitly log out.

### 3. Dev Notes

#### Previous Story Insights
*   This story builds upon the user registration flow (Story 1.1). The Supabase client setup from the previous story will be reused.

#### Data Models
*   No new data models are created in this story. This story primarily interacts with the Supabase Auth service to verify credentials against the existing `auth.users` table.
    *   `[Source: architecture.md#6.1 Component List]`

#### API Specifications
*   Similar to registration, this story does not involve our backend FastAPI service. All interactions will be between the Next.js frontend and the Supabase Auth service.
*   The frontend will use the Supabase client library (`@supabase/supabase-js`) to handle the sign-in flow.
    *   `[Source: architecture.md#6.1 Component List]`

#### Component Specifications
*   **Login Form/Screen**: A new page or modal needs to be created for login.
    *   It should contain input fields for `email` and `password`.
    *   It should use Material-UI (MUI) components like `TextField` and `Button`.
    *   It should handle form state (e.g., input values, loading state, error messages).
    *   A link to the registration page should be provided for new users.
    *   `[Source: front-end-spec.md#4.1 Key Screen Layouts]`
    *   `[Source: front-end-spec.md#5.1 Core Components]`

#### File Locations
*   **Frontend Page**: A new file should be created, likely at `apps/web/src/app/login/page.tsx`.
*   **Frontend Component**: The login form itself could be a reusable component located at `apps/web/src/components/auth/LoginForm.tsx`.

#### Testing Requirements
*   Unit tests should be created for the `LoginForm.tsx` component.
*   Tests should verify:
    *   The form renders correctly.
    *   A successful login call redirects the user.
    *   A failed login call (e.g., wrong password) displays an error message.
    *   `[Source: architecture.md#3.1 Technology Stack Table]`

#### Technical Constraints
*   Authentication must be handled by Supabase Auth.
*   The frontend must use the Supabase JS client library.
*   Supabase's default session management (using cookies) should be leveraged to meet the persistence requirement (AC: 5).

### 4. Tasks / Subtasks

1.  **Create Login UI (AC: 1, 2)**
    *   [ ] Create the login page file at `apps/web/src/app/login/page.tsx`.
    *   [ ] Create the `LoginForm.tsx` component with MUI `TextField` for email/password and a `Button` for submission.
    *   [ ] Reuse the Supabase client utility from Story 1.1.
2.  **Implement Login Logic (AC: 2, 3, 4)**
    *   [ ] In `LoginForm.tsx`, implement the `onSubmit` handler.
    *   [ ] Call the `supabase.auth.signInWithPassword()` method with the user's email and password.
    *   [ ] Handle the success case: redirect the user to the dashboard (`/`).
    *   [ ] Handle the error case: display the error message from Supabase to the user.
3.  **Implement Logout Functionality (AC: 5)**
    *   [ ] In the main App Bar component, add a "Logout" button.
    *   [ ] Create a handler that calls `supabase.auth.signOut()`.
    *   [ ] After signing out, redirect the user to the login page.
4.  **Write Unit Tests (AC: 1, 2, 3, 4)**
    *   [ ] Create a test file `LoginForm.test.tsx`.
    *   [ ] Write tests to simulate user input, submission, success, and failure scenarios.

### 5. QA Results
*   *Pending*
