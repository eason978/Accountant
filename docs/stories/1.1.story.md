---
epic: 1
story-id: 1
title: "User Registration"
status: "Draft"
---

### 1. Story

As a new user, I want to be able to register for an account, so that I can start using the service.

### 2. Acceptance Criteria

1.  A user can navigate to a registration page or use a registration form.
2.  The registration form requires a valid email and a password.
3.  Upon successful registration with Supabase Auth, a corresponding public `Profile` record is automatically created in the database.
4.  After successful registration, the user is automatically logged in and redirected to the main dashboard.
5.  If registration fails (e.g., email already in use), a clear error message is displayed to the user.

### 3. Dev Notes

#### Previous Story Insights
*   No previous story exists. This is the first story.

#### Data Models
*   **`Profile`**: A new record will be created in this table upon successful user registration.
    *   `id`: `UUID` - This will be the foreign key from the `auth.users` table.
    *   `username`: `String` - Can be `null` initially.
    *   `[Source: architecture.md#4.1 Model: Profile]`
*   **`auth.users`**: This is a Supabase-managed table. The registration process will create a new entry here.
    *   `[Source: architecture.md#4.1 Model: Profile]`

#### API Specifications
*   This story does not involve our backend FastAPI service. All interactions will be between the Next.js frontend and the Supabase Auth service.
*   The frontend will use the Supabase client library (`@supabase/supabase-js`) to handle the registration flow.
    *   `[Source: architecture.md#6.1 Component List]`

#### Component Specifications
*   **Registration Form/Screen**: A new page or modal needs to be created.
    *   It should contain input fields for `email` and `password`.
    *   It should use Material-UI (MUI) components like `TextField` and `Button`.
    *   It should handle form state (e.g., input values, loading state, error messages).
    *   `[Source: front-end-spec.md#4.1 Key Screen Layouts]`
    *   `[Source: front-end-spec.md#5.1 Core Components]`

#### File Locations
*   **Frontend Page**: A new file should be created, likely at `apps/web/src/app/register/page.tsx`.
*   **Frontend Component**: The registration form itself could be a reusable component located at `apps/web/src/components/auth/RegisterForm.tsx`.
*   **Shared Types**: No new shared types are expected for this story.

#### Testing Requirements
*   Unit tests should be created for the `RegisterForm.tsx` component.
*   Tests should verify:
    *   The form renders correctly.
    *   Input validation for email and password works as expected.
    *   A successful registration call redirects the user.
    *   A failed registration call displays an error message.
    *   `[Source: architecture.md#3.1 Technology Stack Table]`

#### Technical Constraints
*   Authentication must be handled by Supabase Auth.
*   The frontend must use the Supabase JS client library.
*   UI must be built with Next.js and Material-UI.

### 4. Tasks / Subtasks

1.  **Setup Supabase Client (AC: 1, 2)**
    *   [ ] Install `@supabase/supabase-js` in the `apps/web` package.
    *   [ ] Create a Supabase client utility file (`apps/web/src/lib/supabase/client.ts`) to initialize and export the client instance.
2.  **Create Registration UI (AC: 1, 2)**
    *   [ ] Create the registration page file at `apps/web/src/app/register/page.tsx`.
    *   [ ] Create the `RegisterForm.tsx` component with MUI `TextField` for email/password and a `Button` for submission.
3.  **Implement Registration Logic (AC: 2, 4, 5)**
    *   [ ] In `RegisterForm.tsx`, implement the `onSubmit` handler.
    *   [ ] Call the `supabase.auth.signUp()` method with the user's email and password.
    *   [ ] Handle the success case: redirect the user to the dashboard (`/`).
    *   [ ] Handle the error case: display the error message from Supabase to the user.
4.  **Setup Profile Creation Trigger (AC: 3)**
    *   [ ] In the Supabase dashboard, create a new database function and trigger.
    *   [ ] The trigger should fire after a new user is inserted into the `auth.users` table.
    *   [ ] The function should insert a corresponding row into the `public.profiles` table, using the `id` from the new user record.
    *   `[Source: architecture.md#9. Database Schema]`
5.  **Write Unit Tests (AC: 1, 2, 4, 5)**
    *   [ ] Create a test file `RegisterForm.test.tsx`.
    *   [ ] Write tests to simulate user input, submission, success, and failure scenarios.

### 5. QA Results
*   *Pending*
