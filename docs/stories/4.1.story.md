---
epic: 4
story-id: 1
title: "Manage (View and Delete) Mapping Rules"
status: "Draft"
---

### 1. Story

As a user on the settings page, I want to be able to view a list of my saved mapping rules and delete the ones I no longer need, so that I can maintain my automation rules.

### 2. Acceptance Criteria

1.  A new "My Rules" section is added to the `/settings` page.
2.  A new backend endpoint `GET /api/v1/mapping-rules` is created to fetch all rules for the authenticated user.
3.  A new backend endpoint `DELETE /api/v1/mapping-rules/{ruleId}` is created to delete a specific rule.
4.  The UI calls the `GET` endpoint and displays the fetched rules in a list or table.
5.  Each rule in the list displays its name, trigger keyword, and target mapping.
6.  Each rule has a "Delete" button.
7.  Clicking the "Delete" button calls the `DELETE` endpoint for that `ruleId` and removes the rule from the UI upon success.

### 3. Dev Notes

#### Previous Story Insights
*   This feature will be added to the settings page created in Epic 1 (Story 1.3).

#### Data Models
*   **`MappingRule`**: This story involves reading and deleting records from this table.
    *   `[Source: architecture.md#4.5 Model: MappingRule]`

#### API Specifications
*   **`GET /mapping-rules`**: New endpoint to fetch a list of rules for the user.
*   **`DELETE /mapping-rules/{ruleId}`**: New endpoint to delete a single rule.
    *   Both endpoints must be secured to ensure users can only affect their own rules.
    *   `[Source: architecture.md#5.1 REST API Specification (OpenAPI)]`

#### Component Specifications
*   **Mapping Rules List**: A new component to display the list of rules.
    *   This could be a MUI `Table` or a series of `Card` components.
    *   It will fetch data from the new `GET /mapping-rules` endpoint.
    *   Each item will have a delete button with a confirmation dialog.
    *   `[Source: front-end-spec.md#4.1 Key Screen Layouts]` (The "My Rules" block).

#### File Locations
*   **Frontend Page**: `apps/web/src/app/settings/page.tsx` will be updated to include the new component.
*   **New Frontend Component**: `apps/web/src/components/settings/MappingRulesList.tsx`.
*   **Backend API Endpoints**: A new router `apps/api/routers/mapping_rules.py` will be created for the `GET` and `DELETE` endpoints.

#### Testing Requirements
*   **Backend (Pytest)**:
    *   Write unit tests for the `GET` and `DELETE` endpoints for mapping rules.
    *   Ensure proper authorization is enforced.
*   **Frontend (Jest/RTL)**:
    *   Test the `MappingRulesList` component.
    *   Mock the API calls to test the display of rules, the empty state, and the delete functionality.

### 4. Tasks / Subtasks

1.  **Backend: Create API Endpoints (AC: 2, 3)**
    *   [ ] Create the new router `apps/api/routers/mapping_rules.py`.
    *   [ ] Implement the `GET /` endpoint to fetch all rules for the current user.
    *   [ ] Implement the `DELETE /{ruleId}` endpoint to delete a rule, ensuring the user owns the rule before deletion.
2.  **Frontend: Create UI Component (AC: 1, 4, 5)**
    *   [ ] Create the `MappingRulesList.tsx` component.
    *   [ ] Use a data fetching hook to call `GET /api/v1/mapping-rules`.
    *   [ ] Render the rules in a list or table.
    *   [ ] Add a delete button to each rule.
3.  **Frontend: Implement Delete Logic (AC: 6, 7)**
    *   [ ] When the delete button is clicked, show a confirmation dialog.
    *   [ ] If confirmed, call the `DELETE /api/v1/mapping-rules/{ruleId}` endpoint.
    *   [ ] On success, remove the rule from the local state or refetch the list to update the UI.
4.  **Frontend: Integrate into Settings Page (AC: 1)**
    *   [ ] Import and render the `MappingRulesList` component on the `settings` page.
5.  **Write Tests**
    *   [ ] Implement backend unit tests for the new endpoints.
    *   [ ] Implement frontend unit tests for the new component and delete functionality.

### 5. QA Results
*   *Pending*
